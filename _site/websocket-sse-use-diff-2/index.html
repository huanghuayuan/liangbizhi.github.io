<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="author" content="liangbizhi" />
    <meta name="keywords" content="前端,梁必志,liangbizhi,liangbizhi,Server-Sent Events与WebSockets使用和比较（2）" />
    <meta name="description" content="前端博客，博主脑袋有点异常。Server-Sent Events与WebSockets使用和比较（2）" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Server-Sent Events与WebSockets使用和比较（2）</title>
    <link rel="shortcut icon" href="/media/images/favicon.ico" />
    <link rel="stylesheet" href="/media/css/style.css" />
    <link rel="stylesheet" href="/media/css/iconfont.css" />
    <link rel="stylesheet" href="/media/css/highlight.css" />
    <!--<link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml" />-->
    <!--[if lt IE 9]>
    <div class="bsie">
        您的浏览器版本过旧，请升级为Google Chrome浏览器进行浏览 :-D
        <a href="javascript:void(0);" onclick="this.parentNode.style.display='none';">关闭</a>
    </div>
    <![endif]-->
</head>

<body>
   <!--header-->
    <header id="header" class="">
        <i id="btn-open-sidebar" class="icon iconfont">&#xe60a;</i>
        <h1 class="header-title"><a class="header-title-link" href="/">liangbizhi</a></h1>
        <a class="header-right-picture" href="/about/" title="liangbizhi">
            <img class="header-picture" src="/media/images/avatar.png" alt="头像">
        </a>
    </header>
    <!--sidebar-->
    <nav id="sidebar">
        <div class="sidebar-profile">
            <a href="/about/" title="liangbizhi">
                <img src="/media/images/avatar.png" alt="头像" class="sidebar-profile-picture">
            </a>
            <span class="sidebar-profile-name">liangbizhi</span>
        </div>
        <ul class="sidebar-buttons">
            <li class="sidebar-button">
                    <a class="sidebar-button-link " href="/">
                        <i class="icon iconfont">&#xe603;</i>
                        <span class="sidebar-button-desc">主&nbsp;&nbsp;&nbsp;&nbsp;页</span>
                    </a>
            </li>
            <li class="sidebar-button">
                    <a class="sidebar-button-link " href="/categories/">
                        <i class="icon iconfont">&#xe601;</i>
                        <span class="sidebar-button-desc">分&nbsp;&nbsp;&nbsp;&nbsp;类</span>
                    </a>
            </li>
            <li class="sidebar-button">
                    <a class="sidebar-button-link " href="/tags/">
                        <i class="icon iconfont">&#xe609;</i>
                        <span class="sidebar-button-desc">标&nbsp;&nbsp;&nbsp;&nbsp;签</span>
                    </a>
            </li>
            <li class="sidebar-button">
                    <a class="sidebar-button-link " href="/guestbook/">

                        <i class="icon iconfont">&#xe606;</i>
                        <span class="sidebar-button-desc">留&nbsp;&nbsp;&nbsp;&nbsp;言</span>
                    </a>
            </li>

            <li class="sidebar-button">

                    <a class="sidebar-button-link st-search-show-outputs" href="/about/">

                        <i class="icon iconfont">&#xe604;</i>
                        <span class="sidebar-button-desc">关&nbsp;&nbsp;&nbsp;&nbsp;于</span>
                    </a>
            </li>

            <li class="sidebar-button">

                    <a class="sidebar-button-link " href="javascript:void(0);">

                        <i class="icon iconfont">&#xe607;</i>
                        <span class="sidebar-button-desc">搜&nbsp;&nbsp;&nbsp;&nbsp;索</span>
                    </a>
            </li>

        </ul>
        <ul class="sidebar-buttons">
            <li class="sidebar-button">
                    <a class="sidebar-button-link " href="http://github.com/liangbizhi/" target="_blank">
                        <i class="icon iconfont">&#xe605;</i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            <li class="sidebar-button">
                    <a class="sidebar-button-link " href="https://plus.google.com/107690026046415883872" target="_blank">
                        <i class="icon iconfont">&#xe608;</i>
                        <span class="sidebar-button-desc">Google Plus</span>
                    </a>
            </li>
            <li class="sidebar-button">
                    <a class="sidebar-button-link " href="http://weibo.com/bikuqixinzhi" target="_blank">
                        <i class="icon iconfont">&#xe602;</i>
                        <span class="sidebar-button-desc">Weibo</span>
                    </a>
            </li>

        </ul>
        <ul class="sidebar-buttons">
            <li class="sidebar-button">
                    <a class="sidebar-button-link " href="#">
                        <i class="icon iconfont">&#xe600;</i>
                        <span class="sidebar-button-desc">RSS订阅</span>
                    </a>
            </li>
        </ul>
    </nav>
    <div id="main" role="main">
        <header>
            <h1>Server-Sent Events与WebSockets使用和比较（2）</h1>
        </header>
        <article class="content">
            <section class="meta">
<span class="time">
  <time datetime="2015-04-11">2015-04-11</time>
</span>

 | 
<span class="categories">
  分类
  
  <a href="/categories/#前端" title="前端">前端</a>&nbsp;
  
</span>


 | 
<span class="tags">
  标签
  
  <a href="/tags/#Server-Sent-Event" title="Server-Sent-Event">Server-Sent-Event</a>&nbsp;
  
  <a href="/tags/#WebSocket" title="WebSocket">WebSocket</a>&nbsp;
  
  <a href="/tags/#翻译" title="翻译">翻译</a>&nbsp;
  
</span>

</section>
<section class="post">
<h1>WebSocket</h1>

<p>WebSocket是HTML5开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。在WebSocket API中，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。</p>

<h2>优点</h2>

<ol>
<li>首部（Header）信息很小，大概只有2字节。（早期版本7.0）</li>
<li>服务器可以主动向客户端推送数据。</li>
</ol>

<h2>编写WebSocket客户端程序</h2>

<h3>创建WebSocket对象</h3>

<p>为了使用WebSocket协议进行通信，我们需要创建一个<code>WebSocket</code>对象，它会自动打开与服务器的连接。<code>WebSocket</code>构造器接收一个必选和一个可选的参数：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno">1</span> <span class="nx">WebSocket</span> <span class="nx">WebSocket</span><span class="p">(</span>
<span class="lineno">2</span>     <span class="k">in</span> <span class="nx">DOMString</span> <span class="nx">url</span><span class="p">,</span>
<span class="lineno">3</span>     <span class="k">in</span> <span class="nx">optional</span> <span class="nx">DOMString</span> <span class="nx">protocols</span>
<span class="lineno">4</span>   <span class="p">);</span></code></pre></div>

<p><strong>url</strong>。连接的URI。</p>

<p><strong>protocols</strong> (可选)。一个协议字符串或者一个协议字符串数组。这些字符串用来指示子协议，所以一个单独的服务器就可以实现多种WebSocket子协议（例如，你想服务器根据指定的协议来处理不同类型的内部交互）。如果没有指定，则为空字符串。</p>

<p>该构造器可能抛出异常：</p>

<p><strong>SECURITY_ERR</strong>。连接的端口被堵塞。</p>

<h3>连接出错</h3>

<p>如果连接过程中出现错误，首先一个<code>error</code>事件将会发送给WebSocket对象（即调用它的<code>onerror</code>方法），然后WebSocket将接收到<code>CloseEvent</code>对象（即调用WebSocket的<code>onclose</code>方法），<code>CloseEvent</code>对象指名了连接关闭的原因。</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno">1</span> <span class="nx">ws</span><span class="p">.</span><span class="nx">onclose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">2</span>       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;WebSocketClosed!&quot;</span><span class="p">);</span>
<span class="lineno">3</span>   <span class="p">};</span>
<span class="lineno">4</span>   
<span class="lineno">5</span>   <span class="nx">ws</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">6</span>       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;WebSocketError!&quot;</span><span class="p">);</span>
<span class="lineno">7</span>   <span class="p">};</span></code></pre></div>

<h3>例子</h3>

<p>这个简单的例子中创建了一个新的WebSocket对象，连接到ws://www.example.com/socketserver。自定义了一个“protocolOne”的请求协议。</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno">1</span> <span class="kd">var</span> <span class="nx">exampleSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">&quot;ws://www.example.com/socketserver&quot;</span><span class="p">,</span> <span class="s2">&quot;protocolOne&quot;</span><span class="p">);</span></code></pre></div>

<p>返回时，<code>exampleSocket.readyState</code>的值为<code>CONNECTING</code>。一旦连接准备传输数据，<code>readyState</code>值将会变为<code>OPEN</code>。</p>

<p>如果想打开一个自由的协议支持的连接，可以指定一个协议数组：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno">1</span> <span class="kd">var</span> <span class="nx">exampleSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">&quot;ws://www.example.com/socketserver&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;protocolOne&quot;</span><span class="p">,</span> <span class="s2">&quot;protocolTwo&quot;</span><span class="p">]);</span></code></pre></div>

<p>连接一旦建立（即<code>readyState</code>的值为<code>OPEN</code>）,<code>exampleSocket.protocol</code>会告诉我们服务器选择了哪一个协议。</p>

<p>上面的例子中，<code>ws</code>（scheme）代替了<code>http</code>，类似地，<code>wss</code>将代替<code>https</code>。建立一个WebSocket依赖于HTTP Upgrade机制，所以当我们请求 ws://www.example.com 或者 wss://www.example.com 这样的服务器时，将隐式地请求协议升级。</p>

<h3>发送数据给服务器</h3>

<p>连接一旦打开，我们就可以向服务器传输数据了。调用<code>WebSocket</code>对象的<code>send()</code>方法即可：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno">1</span> <span class="nx">exampleSocket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Here&#39;s some text that the server is urgently awaiting!&quot;</span><span class="p">);</span></code></pre></div>

<p>我们可以发送字符串、<code>Blob</code>或<code>ArrayBuffer</code>数据。</p>

<p>因为建立连接是异步的，在创建WebSocket对象后马上调用<code>send()</code>方法不一定会成功。所以我们最好在<code>onopen</code>方法里执行发送操作：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno">1</span> <span class="nx">exampleSocket</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">2</span>       <span class="nx">exampleSocket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Here&#39;s some text that the server is urgently awaiting!&quot;</span><span class="p">);</span> 
<span class="lineno">3</span>   <span class="p">};</span></code></pre></div>

<p>另外你可以方便地通过JSON发送一些复杂的数据给服务器。例如，一个聊天程序可以使用实现了JSON数据封装的协议与服务器交互：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="c1">// Send text to all users through the server</span>
<span class="lineno"> 2</span>  <span class="kd">function</span> <span class="nx">sendText</span><span class="p">()</span> <span class="p">{</span>
<span class="lineno"> 3</span>      <span class="c1">// Construct a msg object containing the data the server needs to process the message from the chat client.</span>
<span class="lineno"> 4</span>      <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno"> 5</span>          <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span>
<span class="lineno"> 6</span>          <span class="nx">text</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
<span class="lineno"> 7</span>          <span class="nx">id</span><span class="o">:</span>   <span class="nx">clientID</span><span class="p">,</span>
<span class="lineno"> 8</span>          <span class="nx">date</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<span class="lineno"> 9</span>      <span class="p">};</span>
<span class="lineno">10</span>  
<span class="lineno">11</span>      <span class="c1">// Send the msg object as a JSON-formatted string.</span>
<span class="lineno">12</span>      <span class="nx">exampleSocket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msg</span><span class="p">));</span>
<span class="lineno">13</span>    
<span class="lineno">14</span>      <span class="c1">// Blank the text input element, ready to receive the next line of text from the user.</span>
<span class="lineno">15</span>      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="lineno">16</span>    <span class="p">}</span></code></pre></div>

<h3>接收服务器数据</h3>

<p>WebSocket是一个事件驱动API。当接收到了消息，一个<code>message</code>事件将会传递给<code>onmessage</code>函数。为了监听新到来的数据，我们可以这样做：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno">1</span> <span class="nx">exampleSocket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">2</span>       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="lineno">3</span>   <span class="p">}</span></code></pre></div>

<p>让我们来考虑一下上面提到的聊天程序。客户端可能会接收到五花八门的数据包，比如：</p>

<ul>
<li>登陆握手数据包</li>
<li>消息文本数据包</li>
<li>用户列表更新数据包</li>
</ul>

<p>所以解析这些数据的代码可能会是这样的：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="nx">exampleSocket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 2</span>    <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;chatbox&quot;</span><span class="p">).</span><span class="nx">contentDocument</span><span class="p">;</span>
<span class="lineno"> 3</span>    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="lineno"> 4</span>    <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="lineno"> 5</span>    <span class="kd">var</span> <span class="nx">time</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
<span class="lineno"> 6</span>    <span class="kd">var</span> <span class="nx">timeStr</span> <span class="o">=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">toLocaleTimeString</span><span class="p">();</span>
<span class="lineno"> 7</span>    
<span class="lineno"> 8</span>    <span class="k">switch</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 9</span>      <span class="k">case</span> <span class="s2">&quot;id&quot;</span><span class="o">:</span>
<span class="lineno">10</span>        <span class="nx">clientID</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="lineno">11</span>        <span class="nx">setUsername</span><span class="p">();</span>
<span class="lineno">12</span>        <span class="k">break</span><span class="p">;</span>
<span class="lineno">13</span>      <span class="k">case</span> <span class="s2">&quot;username&quot;</span><span class="o">:</span>
<span class="lineno">14</span>        <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;User &lt;em&gt;&quot;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/em&gt; signed in at &quot;</span> <span class="o">+</span> <span class="nx">timeStr</span> <span class="o">+</span> <span class="s2">&quot;&lt;/b&gt;&lt;br&gt;&quot;</span><span class="p">;</span>
<span class="lineno">15</span>        <span class="k">break</span><span class="p">;</span>
<span class="lineno">16</span>      <span class="k">case</span> <span class="s2">&quot;message&quot;</span><span class="o">:</span>
<span class="lineno">17</span>        <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nx">timeStr</span> <span class="o">+</span> <span class="s2">&quot;) &lt;b&gt;&quot;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/b&gt;: &quot;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">text</span> <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
<span class="lineno">18</span>        <span class="k">break</span><span class="p">;</span>
<span class="lineno">19</span>      <span class="k">case</span> <span class="s2">&quot;rejectusername&quot;</span><span class="o">:</span>
<span class="lineno">20</span>        <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;Your username has been set to &lt;em&gt;&quot;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/em&gt; because the name you chose is in use.&lt;/b&gt;&lt;br&gt;&quot;</span>
<span class="lineno">21</span>        <span class="k">break</span><span class="p">;</span>
<span class="lineno">22</span>      <span class="k">case</span> <span class="s2">&quot;userlist&quot;</span><span class="o">:</span>
<span class="lineno">23</span>        <span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="lineno">24</span>        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">25</span>          <span class="nx">ul</span> <span class="o">+=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">users</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
<span class="lineno">26</span>        <span class="p">}</span>
<span class="lineno">27</span>        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;userlistbox&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">ul</span><span class="p">;</span>
<span class="lineno">28</span>        <span class="k">break</span><span class="p">;</span>
<span class="lineno">29</span>    <span class="p">}</span>
<span class="lineno">30</span>    
<span class="lineno">31</span>    <span class="k">if</span> <span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">32</span>      <span class="nx">f</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
<span class="lineno">33</span>      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;chatbox&quot;</span><span class="p">).</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">scrollByPages</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="lineno">34</span>    <span class="p">}</span>
<span class="lineno">35</span>  <span class="p">};</span></code></pre></div>

<p>这里我们使用了<code>JSON.parse()</code>来把JSON对象转换为原始对象，然后进行操作。</p>

<p>通过WebSocket接收到的文本编码为UTF-8。</p>

<h3>关闭连接</h3>

<p>当使用完WebSocket连接后，调用<code>close()</code>方法以关闭资源：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno">1</span> <span class="nx">exampleSocket</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span></code></pre></div>

<p>在关闭之前检验一下socket的<code>bufferedAmount</code>属性以确定是否还有数据在网络上传输是很有帮助的。</p>

<h3>WebSocket服务器</h3>

<p>实现了WebSocket协议的服务器还是挺多的，比如tomcat、node.js等，有兴趣的可以编写一下服务器端的代码。</p>

<h1>两者的比较</h1>

<p>WebSockets和Server-Sent Events（详见上一篇文章）都可以向浏览器推送数据，然而他们并不是相互竞争的技术。</p>

<p>WebSockets连接可以同时发送数据给浏览器，也可以接收来自浏览器的数据。一个可能使用WebSockets的例子就是聊天程序了。</p>

<p>SSE连接仅仅可以推送数据给浏览器。在线股票行情，或者twitter更新都是比较好的例子，它们都可以使用SSE。</p>

<p>实践中，由于SSE可以做的WebSockets都可以做，所以WebSockets正获得更多的关注和青睐，浏览器支持WebSockets更多于SSE。</p>

<p>然而，这对于一些应用来说有点矫枉过正了，并且后端可以更容易实现SSE。</p>

<p>而且SSE在较老的那些不支持该特性的浏览器中更容易实现，仅仅是使用JavaScript。</p>

<p>SSE之所以会被WebSockets掩盖了光芒的原因之一是WebSockets API提供了丰富的协议去处理双向的，全双工的通信。因为WebSockets拥有两个信道，所以它对于游戏、聊天app和那些需要双方实时更新的应用更具有吸引力。然而，在某些场景中，客户端不需要发送数据。我们只是简单地获取服务器的更新数据。例如朋友状态的更新、股票代号、新闻提要更新或者其他一些自动数据推送机制。如果需要向服务器发送数据，使用XMLHttpRequest是个好办法。</p>

<p>SSE工作在传统的HTTP协议上，也就是说它不需要一个特定的协议或者服务器实现来支持。而WebSockets需要全双工连接和新的Web Socket服务器来处理此协议。另外，SSE还有很多WebSockets缺少的特点，比如自动重连，事件ID和发送任意事件的能力。</p>

<h1>总结</h1>

<p>SSE相对于WebSockets的优点：</p>

<ul>
<li>使用简单的HTTP传输，而不是自定义的协议。</li>
<li>SSE可以通过javascript在那些不支持它的浏览器上面实现。</li>
<li>内置支持重连和事件ID。</li>
<li>更简单的协议。</li>
</ul>

<p>WebSockets相对于SSE的优点：</p>

<ul>
<li>实时，双向通信。</li>
<li>更多的浏览器本地支持。</li>
</ul>

<p>一些使用SSE的理想情况：</p>

<ul>
<li>股票行情。</li>
<li>twitter信息更新。</li>
<li>浏览器提醒。</li>
</ul>

<h1>参考</h1>

<p>[1] Stack Overflow <a href="http://stackoverflow.com/questions/5195452/websockets-vs-server-sent-events-eventsource">http://stackoverflow.com/questions/5195452/websockets-vs-server-sent-events-eventsource</a></p>

<p>[2] developer.mozilla.org <a href="https://developer.mozilla.org/en-US/docs/WebSockets/Writing_WebSocket_client_applications" title="developer.mozilla.org">https://developer.mozilla.org/en-US/docs/WebSockets/Writing<em>WebSocket</em>client_applications</a></p>

</section>
<section class="page-nav">
    <br/>
    <p><a  href="/css-def-note/" class=""  >下一篇：《CSS权威指南》复习笔记</a></p>
    <p><a  href="/js-def-note/" class=""  >上一篇：《JavaScript权威指南》复习笔记</a></p>
</section>

	
	<div class="ds-thread" data-thread-key="/websocket-sse-use-diff-2" data-url="http://liangbizhi.github.io/websocket-sse-use-diff-2/" data-title="Server-Sent Events与WebSockets使用和比较（2）" />
		
	<script type="text/javascript">
	/* duoshuo */
	var duoshuoQuery = {short_name:"liangbizhi"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>



        </article>
        <footer>
        <p>Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a> &#64;
            <a href="http://github.com/liangbizhi/liangbizhi.github.io" target="_blank" title="项目主页">GitHub</a>
            | © 2014 - 2015 <a href="/about/">liangbizhi</a>
        </p>
        </footer>
    </div>
</body>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-61782303-1', 'auto');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','1ZarQrPGsHydx-KkvfHz','2.0.0');
</script>
<script type="text/javascript" src="/media/js/script.js"></script>
</html>